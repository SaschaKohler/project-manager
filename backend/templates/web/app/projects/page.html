{% extends "web/app/layout.html" %}
{% load i18n %}

{% block title %}{% trans "Projects" %} Â· Project Manager{% endblock %}

{% block content %}
<div class="flex items-end justify-between gap-6">
  <div>
    <h1 class="text-3xl font-semibold tracking-tight">{% trans "Projects" %}</h1>
    <p class="mt-2 text-sm text-zinc-300">{% trans "Create momentum. Keep scope tight." %}</p>
  </div>
  <a href="{% url 'web:projects_archive_page' %}" class="rounded-lg px-4 py-2 text-sm border border-zinc-800 bg-zinc-900/40 text-zinc-300 hover:bg-zinc-900">
    {% trans "Archived Projects" %}
  </a>
</div>

<div class="mt-8 grid grid-cols-1 lg:grid-cols-3 gap-4">
  <div class="lg:col-span-1 rounded-2xl border border-zinc-800/70 bg-zinc-900/25 p-5 backdrop-blur">
    <div class="text-sm text-zinc-400">{% trans "New project" %}</div>
    <form class="mt-4 space-y-3"
          hx-post="{% url 'web:projects_create' %}"
          hx-target="#project-list"
          hx-swap="afterbegin"
          hx-on::after-request="this.reset()">
      {% csrf_token %}
      <div>
        <label class="block text-xs text-zinc-400 mb-2">{% trans "Title" %}</label>
        <input name="title" required placeholder="{% trans 'e.g. Launch Q1 Campaign' %}"
               class="w-full rounded-lg bg-zinc-950 border border-zinc-800 px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
      </div>
      <div>
        <label class="block text-xs text-zinc-400 mb-2">{% trans "Description" %}</label>
        <textarea name="description" rows="3" placeholder="{% trans '...' %}"
                  class="w-full rounded-lg bg-zinc-950 border border-zinc-800 px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
      </div>
      <div class="grid grid-cols-2 gap-3">
        <div>
          <label class="block text-xs text-zinc-400 mb-2">{% trans "Status" %}</label>
          <select name="status" class="w-full rounded-lg bg-zinc-950 border border-zinc-800 px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-500">
            <option value="PLANNED">{% trans "Planned" %}</option>
            <option value="ACTIVE">{% trans "Active" %}</option>
            <option value="COMPLETED">{% trans "Completed" %}</option>
            <option value="CANCELLED">{% trans "Cancelled" %}</option>
          </select>
        </div>
        <div>
          <label class="block text-xs text-zinc-400 mb-2">{% trans "Priority" %}</label>
          <select name="priority" class="w-full rounded-lg bg-zinc-950 border border-zinc-800 px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-500">
            <option value="LOW">{% trans "Low" %}</option>
            <option value="MEDIUM" selected>{% trans "Medium" %}</option>
            <option value="HIGH">{% trans "High" %}</option>
          </select>
        </div>
      </div>
      <div>
        <label class="block text-xs text-zinc-400 mb-2">{% trans "Category" %}</label>
        <select name="category" class="w-full rounded-lg bg-zinc-950 border border-zinc-800 px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-500">
          <option value="WORKSHOP">Workshop</option>
          <option value="RETREAT">Retreat</option>
          <option value="CONSULTATION">Consultation</option>
          <option value="IT_SERVICE">IT Service</option>
          <option value="MARKETING">Marketing</option>
          <option value="DEVELOPMENT">{% trans "Development" %}</option>
          <option value="DESIGN">{% trans "Design" %}</option>
          <option value="RESEARCH">{% trans "Research" %}</option>
          <option value="CONTENT">{% trans "Content" %}</option>
          <option value="SALES">{% trans "Sales" %}</option>
          <option value="FINANCE">{% trans "Finance" %}</option>
          <option value="LEGAL">{% trans "Legal" %}</option>
          <option value="HR">{% trans "HR" %}</option>
          <option value="OPERATIONS">{% trans "Operations" %}</option>
          <option value="EVENT">{% trans "Event" %}</option>
          <option value="TRAINING">{% trans "Training" %}</option>
        </select>
      </div>
      <div>
        <label class="block text-xs text-zinc-400 mb-2">{% trans "Color" %}</label>
        <div class="grid grid-cols-2 gap-2">
          <div>
            <input id="project-color-indigo" type="radio" name="color" value="indigo" class="peer sr-only" checked />
            <label for="project-color-indigo" class="flex items-center gap-2 rounded-lg border border-zinc-800 bg-zinc-950 px-3 py-2 text-sm text-zinc-200 cursor-pointer hover:bg-zinc-900/40 peer-checked:border-indigo-500/70 peer-checked:ring-2 peer-checked:ring-indigo-500/30">
              <span class="w-3 h-3 rounded-full bg-indigo-500"></span>
              <span>Indigo</span>
            </label>
          </div>
          <div>
            <input id="project-color-emerald" type="radio" name="color" value="emerald" class="peer sr-only" />
            <label for="project-color-emerald" class="flex items-center gap-2 rounded-lg border border-zinc-800 bg-zinc-950 px-3 py-2 text-sm text-zinc-200 cursor-pointer hover:bg-zinc-900/40 peer-checked:border-emerald-500/70 peer-checked:ring-2 peer-checked:ring-emerald-500/30">
              <span class="w-3 h-3 rounded-full bg-emerald-500"></span>
              <span>Emerald</span>
            </label>
          </div>
          <div>
            <input id="project-color-sky" type="radio" name="color" value="sky" class="peer sr-only" />
            <label for="project-color-sky" class="flex items-center gap-2 rounded-lg border border-zinc-800 bg-zinc-950 px-3 py-2 text-sm text-zinc-200 cursor-pointer hover:bg-zinc-900/40 peer-checked:border-sky-500/70 peer-checked:ring-2 peer-checked:ring-sky-500/30">
              <span class="w-3 h-3 rounded-full bg-sky-500"></span>
              <span>Sky</span>
            </label>
          </div>
          <div>
            <input id="project-color-violet" type="radio" name="color" value="violet" class="peer sr-only" />
            <label for="project-color-violet" class="flex items-center gap-2 rounded-lg border border-zinc-800 bg-zinc-950 px-3 py-2 text-sm text-zinc-200 cursor-pointer hover:bg-zinc-900/40 peer-checked:border-violet-500/70 peer-checked:ring-2 peer-checked:ring-violet-500/30">
              <span class="w-3 h-3 rounded-full bg-violet-500"></span>
              <span>Violet</span>
            </label>
          </div>
          <div>
            <input id="project-color-rose" type="radio" name="color" value="rose" class="peer sr-only" />
            <label for="project-color-rose" class="flex items-center gap-2 rounded-lg border border-zinc-800 bg-zinc-950 px-3 py-2 text-sm text-zinc-200 cursor-pointer hover:bg-zinc-900/40 peer-checked:border-rose-500/70 peer-checked:ring-2 peer-checked:ring-rose-500/30">
              <span class="w-3 h-3 rounded-full bg-rose-500"></span>
              <span>Rose</span>
            </label>
          </div>
          <div>
            <input id="project-color-amber" type="radio" name="color" value="amber" class="peer sr-only" />
            <label for="project-color-amber" class="flex items-center gap-2 rounded-lg border border-zinc-800 bg-zinc-950 px-3 py-2 text-sm text-zinc-200 cursor-pointer hover:bg-zinc-900/40 peer-checked:border-amber-500/70 peer-checked:ring-2 peer-checked:ring-amber-500/30">
              <span class="w-3 h-3 rounded-full bg-amber-500"></span>
              <span>Amber</span>
            </label>
          </div>
          <div>
            <input id="project-color-teal" type="radio" name="color" value="teal" class="peer sr-only" />
            <label for="project-color-teal" class="flex items-center gap-2 rounded-lg border border-zinc-800 bg-zinc-950 px-3 py-2 text-sm text-zinc-200 cursor-pointer hover:bg-zinc-900/40 peer-checked:border-teal-500/70 peer-checked:ring-2 peer-checked:ring-teal-500/30">
              <span class="w-3 h-3 rounded-full bg-teal-500"></span>
              <span>Teal</span>
            </label>
          </div>
          <div>
            <input id="project-color-orange" type="radio" name="color" value="orange" class="peer sr-only" />
            <label for="project-color-orange" class="flex items-center gap-2 rounded-lg border border-zinc-800 bg-zinc-950 px-3 py-2 text-sm text-zinc-200 cursor-pointer hover:bg-zinc-900/40 peer-checked:border-orange-500/70 peer-checked:ring-2 peer-checked:ring-orange-500/30">
              <span class="w-3 h-3 rounded-full bg-orange-500"></span>
              <span>Orange</span>
            </label>
          </div>
          <div>
            <input id="project-color-lime" type="radio" name="color" value="lime" class="peer sr-only" />
            <label for="project-color-lime" class="flex items-center gap-2 rounded-lg border border-zinc-800 bg-zinc-950 px-3 py-2 text-sm text-zinc-200 cursor-pointer hover:bg-zinc-900/40 peer-checked:border-lime-500/70 peer-checked:ring-2 peer-checked:ring-lime-500/30">
              <span class="w-3 h-3 rounded-full bg-lime-500"></span>
              <span>Lime</span>
            </label>
          </div>
          <div>
            <input id="project-color-fuchsia" type="radio" name="color" value="fuchsia" class="peer sr-only" />
            <label for="project-color-fuchsia" class="flex items-center gap-2 rounded-lg border border-zinc-800 bg-zinc-950 px-3 py-2 text-sm text-zinc-200 cursor-pointer hover:bg-zinc-900/40 peer-checked:border-fuchsia-500/70 peer-checked:ring-2 peer-checked:ring-fuchsia-500/30">
              <span class="w-3 h-3 rounded-full bg-fuchsia-500"></span>
              <span>Fuchsia</span>
            </label>
          </div>
        </div>
      </div>
      <div class="grid grid-cols-2 gap-3">
        <div>
          <label class="block text-xs text-zinc-400 mb-2">{% trans "Start date" %}</label>
          <input type="date" name="start_date"
                 class="w-full rounded-lg bg-zinc-950 border border-zinc-800 px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
        </div>
        <div>
          <label class="block text-xs text-zinc-400 mb-2">{% trans "End date" %}</label>
          <input type="date" name="end_date"
                 class="w-full rounded-lg bg-zinc-950 border border-zinc-800 px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
        </div>
      </div>
      <div>
        <label class="block text-xs text-zinc-400 mb-2">{% trans "Budget" %}</label>
        <input name="budget" placeholder="{% trans '0.00' %}"
               class="w-full rounded-lg bg-zinc-950 border border-zinc-800 px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
      </div>
      <button type="submit" class="w-full rounded-lg bg-indigo-600 hover:bg-indigo-500 transition px-3 py-2 font-medium">
        {% trans "Create" %}
      </button>
    </form>
  </div>

  <div class="lg:col-span-2 rounded-2xl border border-zinc-800/70 bg-zinc-900/20">
    <div class="px-5 py-4 border-b border-zinc-800/70 flex items-center justify-between">
      <div class="text-sm text-zinc-400">{% trans "All projects" %}</div>
      <div id="project-count" class="text-xs text-zinc-500">{{ projects|length }} {% trans "total" %}</div>
    </div>
    <div id="project-list" class="divide-y divide-zinc-800/70">
      {% for project in projects %}
        {% include "web/app/projects/_project_row.html" with project=project %}
      {% empty %}
        <div id="project-empty" class="p-6 text-sm text-zinc-400">{% trans "No projects yet. Create the first one on the left." %}</div>
      {% endfor %}
    </div>
  </div>
</div>

<script>
  function cleanupProjectEmptyState() {
    const list = document.getElementById('project-list');
    if (!list) return;
    const hasRows = list.querySelector('[data-project-id]');
    if (!hasRows) return;
    const empty = document.getElementById('project-empty');
    if (empty) empty.remove();
  }

  document.addEventListener('DOMContentLoaded', cleanupProjectEmptyState);
  document.body.addEventListener('htmx:afterSwap', cleanupProjectEmptyState);
</script>
{% endblock %}
